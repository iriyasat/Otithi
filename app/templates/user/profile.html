{% extends "base.html" %}

{% block title %}My Profile - Othiti{% endblock %}

{% block content %}
<div class="page-heading header-text">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <span class="breadcrumb"><a href="{{ url_for('public.index') }}">Home</a> / My Profile</span>
        <h3>My Profile</h3>
      </div>
    </div>
  </div>
</div>

<div class="single-property section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <div class="main-content">
          <span class="category">{{ current_user.role.title() }}</span>
          <h4>{{ current_user.username }}'s Profile</h4>
          <p>Welcome to your Othiti profile! Here you can manage your account information, view your activity, and access all your bookings and listings. We're here to help you make the most of your authentic hospitality experience.</p>
        </div>
        
        <!-- Profile Information -->
        <div class="accordion" id="profileAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                Account Information
              </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#profileAccordion">
              <div class="accordion-body">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label text-muted">Username</label>
                    <p class="form-control-plaintext">{{ current_user.username }}</p>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label text-muted">Email</label>
                    <p class="form-control-plaintext">{{ current_user.email }}</p>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label text-muted">Role</label>
                    <p class="form-control-plaintext">{{ current_user.role.title() }}</p>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label text-muted">Member Since</label>
                    <p class="form-control-plaintext">{{ current_user.created_at.strftime('%B %Y') }}</p>
                  </div>
                  {% if current_user.phone %}
                  <div class="col-md-6 mb-3">
                    <label class="form-label text-muted">Phone</label>
                    <p class="form-control-plaintext">{{ current_user.phone }}</p>
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <!-- Profile Avatar -->
        <div class="info-table">
          <div class="text-center mb-4">
            {% if current_user.profile_image %}
              <img src="{{ url_for('static', filename='uploads/' + current_user.profile_image) }}" 
                   alt="{{ current_user.username }}" class="rounded-circle" width="120" height="120" style="object-fit: cover;">
            {% else %}
              <img src="{{ url_for('static', filename='images/ui/default_avatar.png') }}" 
                   alt="{{ current_user.username }}" class="rounded-circle" width="120" height="120">
            {% endif %}
          </div>
          <ul>
            <li>
              <img src="{{ url_for('static', filename='images/info-icon-01.png') }}" alt="" style="max-width: 52px;">
              <h4>{{ current_user.bookings|length }}<br><span>My Bookings</span></h4>
            </li>
            {% if current_user.role == 'host' %}
            <li>
              <img src="{{ url_for('static', filename='images/info-icon-02.png') }}" alt="" style="max-width: 52px;">
              <h4>{{ current_user.listings|length }}<br><span>My Listings</span></h4>
            </li>
            <li>
              <img src="{{ url_for('static', filename='images/info-icon-03.png') }}" alt="" style="max-width: 52px;">
              <h4>{{ current_user.reviews_written|length }}<br><span>Reviews</span></h4>
            </li>
            {% endif %}
            <li>
              <img src="{{ url_for('static', filename='images/info-icon-04.png') }}" alt="" style="max-width: 52px;">
              <h4>{% if current_user.is_verified %}Verified{% else %}Pending{% endif %}<br><span>Account Status</span></h4>
            </li>
          </ul>
        </div>
        
        <!-- Action Buttons -->
        <div class="contact-form">
          <div class="row">
            <div class="col-lg-12">
              <div class="main-button">
                <a href="{{ url_for('user.edit_profile') }}">Edit Profile</a>
              </div>
              {% if current_user.role == 'guest' %}
              <div class="main-button mt-3">
                <a href="{{ url_for('host.become_host') }}">Become a Host</a>
              </div>
              {% endif %}
              <div class="main-button mt-3">
                <a href="{{ url_for('user.my_bookings') }}">My Bookings</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Stats Section -->
<div class="fun-facts">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="wrapper">
          <div class="row">
            <div class="col-lg-4">
              <div class="counter">
                <h2 class="timer count-title count-number" data-to="{{ current_user.bookings|length }}" data-speed="1000"></h2>
                 <p class="count-text ">Total<br>Bookings</p>
              </div>
            </div>
            {% if current_user.role == 'host' %}
            <div class="col-lg-4">
              <div class="counter">
                <h2 class="timer count-title count-number" data-to="{{ current_user.listings|length }}" data-speed="1000"></h2>
                <p class="count-text ">Active<br>Listings</p>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="counter">
                <h2 class="timer count-title count-number" data-to="{{ current_user.reviews_written|length }}" data-speed="1000"></h2>
                <p class="count-text ">Reviews<br>Written</p>
              </div>
            </div>
            {% else %}
            <div class="col-lg-4">
              <div class="counter">
                <h2 class="timer count-title count-number" data-to="0" data-speed="1000"></h2>
                <p class="count-text ">Future<br>Trips</p>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="counter">
                <h2 class="timer count-title count-number" data-to="0" data-speed="1000"></h2>
                <p class="count-text ">Wishlist<br>Items</p>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Recent Activity Section -->
<div class="section best-deal">
  <div class="container">
    <div class="row">
      <div class="col-lg-4">
        <div class="section-heading">
          <h6>| Recent Activity</h6>
          <h2>Your Latest Activity</h2>
        </div>
      </div>
      <div class="col-lg-12">
        <div class="tabs-content">
          <div class="row">
            <div class="nav-wrapper ">
              <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="bookings-tab" data-bs-toggle="tab" data-bs-target="#bookings" type="button" role="tab" aria-controls="bookings" aria-selected="true">Bookings</button>
                </li>
                {% if current_user.role == 'host' %}
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="listings-tab" data-bs-toggle="tab" data-bs-target="#listings" type="button" role="tab" aria-controls="listings" aria-selected="false">Listings</button>
                </li>
                {% endif %}
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">Reviews</button>
                </li>
              </ul>
            </div>              
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="bookings" role="tabpanel" aria-labelledby="bookings-tab">
                <div class="row">
                  <div class="col-lg-12">
                    {% if current_user.bookings %}
                      {% for booking in current_user.bookings[:3] %}
                      <div class="item mb-4">
                        <div class="row">
                          <div class="col-lg-8">
                            <h4><a href="{{ url_for('listings.listing_detail', id=booking.listing.id) }}">{{ booking.listing.title }}</a></h4>
                            <p>Booked on {{ booking.created_at.strftime('%B %d, %Y') }} for {{ booking.check_in_date.strftime('%B %d') }} - {{ booking.check_out_date.strftime('%B %d, %Y') }}</p>
                          </div>
                          <div class="col-lg-4 text-end">
                            <h6>à§³{{ booking.total_price }}</h6>
                            <span class="badge bg-{{ 'success' if booking.status == 'CONFIRMED' else 'warning' }}">{{ booking.status.title() }}</span>
                          </div>
                        </div>
                      </div>
                      {% endfor %}
                    {% else %}
                      <div class="text-center">
                        <h4>No bookings yet</h4>
                        <p>Start your journey by exploring our listings!</p>
                        <div class="main-button">
                          <a href="{{ url_for('listings.listings') }}">Browse Listings</a>
                        </div>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% if current_user.role == 'host' %}
              <div class="tab-pane fade" id="listings" role="tabpanel" aria-labelledby="listings-tab">
                <div class="row">
                  <div class="col-lg-12">
                    {% if current_user.listings %}
                      {% for listing in current_user.listings[:3] %}
                      <div class="item mb-4">
                        <div class="row">
                          <div class="col-lg-8">
                            <h4><a href="{{ url_for('listings.listing_detail', id=listing.id) }}">{{ listing.title }}</a></h4>
                            <p>{{ listing.location }} â¢ à§³{{ listing.price_per_night }}/night</p>
                          </div>
                          <div class="col-lg-4 text-end">
                            <span class="badge bg-{{ 'success' if listing.status == 'APPROVED' else 'warning' }}">{{ listing.status.title() }}</span>
                          </div>
                        </div>
                      </div>
                      {% endfor %}
                    {% else %}
                      <div class="text-center">
                        <h4>No listings yet</h4>
                        <p>Start hosting by creating your first listing!</p>
                        <div class="main-button">
                          <a href="{{ url_for('host.add_listing') }}">Add Listing</a>
                        </div>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endif %}
              <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                <div class="row">
                  <div class="col-lg-12">
                    {% if current_user.reviews_written %}
                      {% for review in current_user.reviews_written[:3] %}
                      <div class="item mb-4">
                        <div class="row">
                          <div class="col-lg-8">
                            <h4>Review for {{ review.listing.title }}</h4>
                            <p>{{ review.comment[:100] }}{% if review.comment|length > 100 %}...{% endif %}</p>
                          </div>
                          <div class="col-lg-4 text-end">
                            <div class="stars">
                              {% for i in range(review.rating) %}
                                <i class="fa fa-star text-warning"></i>
                              {% endfor %}
                            </div>
                          </div>
                        </div>
                      </div>
                      {% endfor %}
                    {% else %}
                      <div class="text-center">
                        <h4>No reviews yet</h4>
                        <p>Share your experiences by writing reviews!</p>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 