{% extends "base.html" %}

{% block title %}Admin Dashboard - Otithi{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Admin Dashboard Container -->
<div class="dashboard-container admin-dashboard">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="container">
            <h1>
                {% if user and user.profile_photo %}
                    <img src="{{ url_for('static', filename='uploads/' + user.profile_photo) }}" alt="{{ user.full_name }}" class="dashboard-profile-image">
                {% else %}
                    <i class="fas fa-user-shield"></i>
                {% endif %}
                Admin Dashboard
            </h1>
            <p class="lead">Welcome back, {{ user.full_name }}! Manage your platform from here.</p>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Statistics -->
        <div class="dashboard-stats">
            <div class="row">
                <div class="col-md-3 mb-4">
                    <div class="stat-card bg-primary text-white">
                        <div class="card-body">
                            <h5>Total Users</h5>
                            <h2>{{ stats.total_users if stats else (users|length if users else 0) }}</h2>
                            <i class="fas fa-users fa-3x"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="stat-card bg-success text-white">
                        <div class="card-body">
                            <h5>Total Listings</h5>
                            <h2>{{ stats.total_listings if stats else (listings|length if listings else 0) }}</h2>
                            <i class="fas fa-home fa-3x"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="stat-card bg-info text-white">
                        <div class="card-body">
                            <h5>Total Bookings</h5>
                            <h2>{{ stats.total_bookings if stats else (bookings|length if bookings else 0) }}</h2>
                            <i class="fas fa-calendar-check fa-3x"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="stat-card bg-warning text-white">
                        <div class="card-body">
                            <h5>Revenue</h5>
                            <h2>{{ stats.revenue_display if stats else "à§³0.0K" }}</h2>
                            <i class="fas fa-money-bill-wave fa-3x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Bookings Section -->
        <div class="row mt-4">
            <div class="col-lg-12">
                <div class="action-card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-calendar-check me-2"></i>
                            Recent Bookings
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if bookings %}
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Booking ID</th>
                                        <th>Guest</th>
                                        <th>Dates</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for booking in bookings[:10] %}
                                    <tr>
                                        <td>
                                            <span class="fw-medium">#{{ booking.id }}</span>
                                        </td>
                                        <td>
                                            <span>Guest</span>
                                        </td>
                                        <td>
                                            <div>
                                                <div>{{ booking.check_in.strftime('%b %d, %Y') if booking.check_in else 'TBD' }}</div>
                                                <small class="text-muted">to {{ booking.check_out.strftime('%b %d, %Y') if booking.check_out else 'TBD' }}</small>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-{{ 'success' if booking.status == 'confirmed' else 'warning' if booking.status == 'pending' else 'danger' }}">
                                                {{ booking.status.title() if booking.status else 'Pending' }}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-info btn-sm" title="View Booking">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-outline-success btn-sm" title="Confirm Booking">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-outline-danger btn-sm" title="Cancel Booking">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-calendar-check fa-3x text-muted mb-3"></i>
                            <h5>No bookings found</h5>
                            <p class="text-muted">No bookings have been made yet.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-lg-12">
                <div class="action-card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-bolt me-2"></i>
                            Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="admin-quick-actions">
                            <button class="admin-quick-action" title="View System Status">
                                <i class="fas fa-server"></i>
                                System Status
                            </button>
                            <button class="admin-quick-action" title="Export Platform Data">
                                <i class="fas fa-download"></i>
                                Export Data
                            </button>
                            <button class="admin-quick-action" title="Platform Settings">
                                <i class="fas fa-cog"></i>
                                Platform Settings
                            </button>
                            <button class="admin-quick-action" onclick="location.reload()" title="Refresh Dashboard">
                                <i class="fas fa-sync-alt"></i>
                                Refresh Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="row mt-4">
            <div class="col-lg-12">
                <div class="activity-card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-info-circle me-2"></i>
                            System Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="system-status-grid">
                            <div class="system-status-item">
                                <div class="system-status-icon text-success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="system-status-label">Server Status</div>
                                <div class="system-status-value text-success">Online</div>
                            </div>
                            <div class="system-status-item">
                                <div class="system-status-icon text-info">
                                    <i class="fas fa-database"></i>
                                </div>
                                <div class="system-status-label">Database</div>
                                <div class="system-status-value text-success">Connected</div>
                            </div>
                            <div class="system-status-item">
                                <div class="system-status-icon text-warning">
                                    <i class="fas fa-memory"></i>
                                </div>
                                <div class="system-status-label">Memory Usage</div>
                                <div class="system-status-value">78%</div>
                            </div>
                            <div class="system-status-item">
                                <div class="system-status-icon text-primary">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="system-status-label">Uptime</div>
                                <div class="system-status-value">7 days</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/admin-verification.js') }}"></script>
<script>
// Add hover effects to action buttons
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.btn').forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-1px)';
        });
        
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>
{% endblock %}
